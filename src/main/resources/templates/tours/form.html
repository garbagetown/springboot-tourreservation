<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/web/thymeleaf/layout"
      layout:decorator="layout">
<head>
    <meta charset="UTF-8"/>
</head>
<body>
<div layout:fragment="content">
    <div layout:include="common/top" />
    <h2 th:text="#{label.tr.searchtour.searchTourMessage}" />
    <div th:utext="#{label.tr.searchtour.searchTourFlowMessage}"/>
    <div th:utext="#{label.tr.searchtour.searchTourInstructionsMessage}"/>
    <div th:text="#{label.tr.searchtour.SearchCriteriaTourMessage}"/>
    <form th:action="@{/tours/search}" th:object="${tourForm}" method="get">
        <span th:text="#{label.tr.common.depDate}" />
        <select name="depYear" th:field="*{depYear}" th:errorclass="fieldError">
            <option th:each="m : ${CL_DEP_YEAR}" th:value="${m.key}" th:text="${m.value}"></option>
        </select>
        <span th:text="#{label.tr.common.year}" />
        <select name="depMonth" th:field="*{depMonth}" th:errorclass="fieldError">
            <option th:each="m : ${CL_MONTH}" th:value="${m.key}" th:text="${m.value}"></option>
        </select>
        <span th:text="#{label.tr.common.month}" />
        <select name="depDay" th:field="*{depDay}" th:errorclass="fieldError">
            <option th:each="m : ${CL_DAY}" th:value="${m.key}" th:text="${m.value}"></option>
        </select>
        <span th:text="#{label.tr.common.day}" />
        (<span th:text="#{label.tr.searchtour.depDateRestrictMessage}" />)<br/>
        <span th:text="#{label.tr.common.tourDays}" />
        <select name="tourDays" th:field="*{tourDays}" th:errorclass="fieldError">
            <option th:each="m : ${CL_TOUR_DAYS}" th:value="${m.key}" th:text="${m.value}"></option>
        </select><br/>
        <span th:text="#{label.tr.common.depPlace}" />
        <select name="depCode" th:field="*{depCode}" th:errorclass="fieldError">
            <option th:each="m : ${CL_PREF}" th:value="${m.key}" th:text="${m.value}"></option>
        </select><br/>
        <span th:text="#{label.tr.common.arrPlace}" />
        <select name="arrCode" th:field="*{arrCode}" th:errorclass="fieldError">>
            <option th:each="m : ${CL_PREF}" th:value="${m.key}" th:text="${m.value}"></option>
        </select><br/>
        <span th:text="#{label.tr.common.persons}" /><br/>
        <span th:text="#{label.tr.common.adult}" />
        <select name="adultCount" th:field="*{adultCount}" th:errorclass="fieldError">
            <option th:each="m : ${CL_ADULT_COUNT}" th:value="${m.key}" th:text="${m.value}"></option>
        </select>
        <span th:text="#{label.tr.common.person}" /><br/>
        <span th:text="#{label.tr.common.child}" />
        <select name="childCount" th:field="*{childCount}" th:errorclass="fieldError">
            <option th:each="m : ${CL_CHILD_COUNT}" th:value="${m.key}" th:text="${m.value}"></option>
        </select>
        <span th:text="#{label.tr.common.person}" />
        (<span th:text="#{label.tr.searchtour.personsRestrictMessage}" />)<br/>
        <span th:text="#{label.tr.common.basePrice}" />
        <select name="basePrice" th:field="*{basePrice}" th:errorclass="fieldError">>
            <option th:each="m : ${CL_BASE_PRICE}" th:value="${m.key}" th:text="${m.value}"></option>
        </select><br/>
        <button th:text="#{label.tr.common.search}" />
    </form>

    <div th:if="${page}">
        <ul>
            <li>
                <a href="tours" th:href="@{/tours/search(
                   page='0', size=${page.size},
                   adultCount=${form.adultCount},
                   arrCode=${form.arrCode},
                   basePrice=${form.basePrice},
                   childCount=${form.childCount},
                   depCode=${form.depCode},
                   depDay=${form.depDay},
                   depMonth=${form.depMonth},
                   depYear=${form.depYear},
                   tourDays=${form.tourDays}
                )}">&lt;&lt;</a>
            </li>
            <li>
                <a href="tours" th:href="@{/tours/search(
                   page=${page.number - 1}, size=${page.size},
                   adultCount=${form.adultCount},
                   arrCode=${form.arrCode},
                   basePrice=${form.basePrice},
                   childCount=${form.childCount},
                   depCode=${form.depCode},
                   depDay=${form.depDay},
                   depMonth=${form.depMonth},
                   depYear=${form.depYear},
                   tourDays=${form.tourDays}
                )}">&lt;</a>
            </li>
            <li th:each="i : ${#numbers.sequence(0, page.totalPages - 1)}">
                <a href="tours" th:href="@{/tours/search(
                   page=${i}, size=${page.size},
                   adultCount=${form.adultCount},
                   arrCode=${form.arrCode},
                   basePrice=${form.basePrice},
                   childCount=${form.childCount},
                   depCode=${form.depCode},
                   depDay=${form.depDay},
                   depMonth=${form.depMonth},
                   depYear=${form.depYear},
                   tourDays=${form.tourDays}
                )}" th:text="${i + 1}">0</a>
            </li>
            <li>
                <a href="tours" th:href="@{/tours/search(
                   page=${page.number + 1}, size=${page.size},
                   adultCount=${form.adultCount},
                   arrCode=${form.arrCode},
                   basePrice=${form.basePrice},
                   childCount=${form.childCount},
                   depCode=${form.depCode},
                   depDay=${form.depDay},
                   depMonth=${form.depMonth},
                   depYear=${form.depYear},
                   tourDays=${form.tourDays}
                )}">&gt;</a>
            </li>
            <li>
                <a href="tours" th:href="@{/tours/search(
                   page=${page.totalPages - 1}, size=${page.size},
                   adultCount=${form.adultCount},
                   arrCode=${form.arrCode},
                   basePrice=${form.basePrice},
                   childCount=${form.childCount},
                   depCode=${form.depCode},
                   depDay=${form.depDay},
                   depMonth=${form.depMonth},
                   depYear=${form.depYear},
                   tourDays=${form.tourDays}
                )}">&gt;&gt;</a>
            </li>
        </ul>
    </div>

    <table th:if="${page}">
        <thead>
            <tr>
                <td th:text="#{label.tr.common.idx}" />
                <td th:text="#{label.tr.common.tourName}" />
                <td th:text="#{label.tr.common.depDate}" />
                <td th:text="#{label.tr.common.tourDays}" />
                <td th:text="#{label.tr.common.depPlace}" />
                <td th:text="#{label.tr.common.arrPlace}" />
                <td th:text="#{label.tr.common.basePrice}" />
            </tr>
        </thead>
        <tbody>
            <tr th:each="tour,status : ${page.content}">
                <td th:text="${status.count}" />
                <td>
                    <a href="tours" th:href="@{'/tours/' + ${tour.tourCode}(
                       form,
                       adultCount=${form.adultCount},
                       childCount=${form.childCount}
                    )}" th:text="${tour.tourName}" />
                </td>
                <td th:text="${#dates.format(tour.depDay, #messages.msg('label.tr.common.datePattern'))}" />
                <td th:text="${tour.tourDays}" />
                <td th:text="${tour.departure.depName}" />
                <td th:text="${tour.arrival.arrName}" />
                <td th:text="${#numbers.formatInteger(tour.basePrice, 3, 'COMMA') + 'å††'}" />
            </tr>
        </tbody>
    </table>

</div>
</body>
</html>
